import sqlite3
import os

# Ensure the data folder exists
os.makedirs("data", exist_ok=True)

# Path to the database
DB_PATH = "data/tools.db"

# Connect to SQLite (this will create the file if it doesn't exist)
conn = sqlite3.connect(DB_PATH)
c = conn.cursor()

# Create tables
c.execute("""
CREATE TABLE IF NOT EXISTS tools (
    uid TEXT PRIMARY KEY,
    name TEXT NOT NULL
)
""")

c.execute("""
CREATE TABLE IF NOT EXISTS users (
    uid TEXT PRIMARY KEY,
    name TEXT NOT NULL
)
""")

c.execute("""
CREATE TABLE IF NOT EXISTS borrows (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    user_uid TEXT NOT NULL,
    tool_uid TEXT NOT NULL,
    borrow_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    return_time TIMESTAMP,
    FOREIGN KEY(user_uid) REFERENCES users(uid),
    FOREIGN KEY(tool_uid) REFERENCES tools(uid)
)
""")

# Preload some tools
tools = [
    """('AA:BB:CC:01', 'Screwdriver'),
    ('AA:BB:CC:02', 'Hammer'),
    ('AA:BB:CC:03', 'Pliers'),"""
]

c.executemany("INSERT OR IGNORE INTO tools (uid, name) VALUES (?, ?)", tools)

conn.commit()
conn.close()

print("Database 'tools.db' created with tables and predefined tools!")
